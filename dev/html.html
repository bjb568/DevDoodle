<section id="main">
	<h1><span id="title">$title</span> <input type="text" id="edit-title" hidden="" value="$title" />  <small><a id="save">Save</a></small></h1>
	<div class="row">
		<div id="right" class="half">
			<iframe id="output" sandbox="allow-scripts"></iframe>
			<button onclick="run(1)">Restart</button><span class="rit"><input id="autorun" type="checkbox" checked="" /> <label for="autorun">Autorun</label></span>
		</div>
		<div id="left" class="half">
			<textarea id="html" spellcheck="false" autocapitalize="off" autocorrect="off" placeholder="HTML" wrap="off">$html</textarea>
			<textarea id="css" spellcheck="false" autocapitalize="off" autocorrect="off" placeholder="CSS" wrap="off">$css</textarea>
			<textarea id="js" spellcheck="false" autocapitalize="off" autocorrect="off" placeholder="JS" wrap="off">$js</textarea>
		</div>
	</div>
</section>
<section id="meta">
	<div class="rit user user-$op">
		<img src="/ap/pic/?n=$op" width="40" height="40" />
		<div>
			<a href="/user/$op/">$op</a>
			<small class="rep">$op-rep</small>
		</div>
	</div>
	Created <time datetime="$created">67 days ago</time>, Updated <time id="updated" datetime="$updated">67 days ago</time>.
	<div class="umar">
		<svg id="up" xmlns="http://www.w3.org/2000/svg"><polygon points="11,1 1,23 21,23"></polygon></svg>
		<svg id="dn" xmlns="http://www.w3.org/2000/svg"><polygon points="11,23 1,1 21,1"></polygon></svg>
		<svg id="fl" xmlns="http://www.w3.org/2000/svg"><polygon points="1,1 19,1 19,11 5,11 5,23 1,23"></polygon></svg>
	</div>
</section>
<style>
	*::-webkit-input-placeholder { color: #888 }
	*::-moz-placeholder { color: #999 }
	body, #content, #footer, #main { background: #000 }
	#content { padding-top: 0 }
	a:hover {
		color: #4ff;
	}
	a:active {
		color: #06f;
	}
	#main :not(input):not(button), #footer * {
		color: #fff;
	}
	#meta {
		clear: both;
		padding: 4px;
		background: rgba(255, 255, 255, .8);
		color: #000;
	}
	textarea {
		color: #fff;
		background: #000;
		font-family: monospace;
		font-size: 1rem;
		width: 100%;
		margin: 4px 0;
	}
	.half {
		max-width: 90vw;
	}
	textarea, #output {
		max-width: 100%;
		border: 1px solid #fff;
		outline: none;
		white-space: pre;
	}
	#left {
		height: 900px;
	}
	#right {
		height: 400px
	}
	@media (min-width: 700px) {
		.row { height: calc(100% - 2em) }
		#left, #right {
			height: 100%;
			margin-bottom: 0;
			max-width: 50%;
		}
		#left { float: left }
		#right { float: right }
	}
	iframe {
		width: 100%;
		height: calc(100% - 24px);
		background: #fff;
	}
	textarea {
		height: calc(33.33% - 2px);
		resize: none;
	}
	#save.progress {
		cursor: progress;
		color: #4ff;
	}
	#up, #dn {
		width: 22px;
		height: 24px;
		fill: #777;
	}
	#up:hover, #dn:hover {
		fill: #888;
		transition: fill 0.1s;
	}
	#up:active, #dn:active {
		fill: #666;
		transition: none;
	}
	#up.clkd, #dn.clkd {
		fill: #f90;
	}
	#fl {
		width: 20px;
		height: 24px;
		fill: #f44;
		margin-left: 12px;
	}
	#fl:hover {
		fill: #f55;
		transition: fill 0.2s;
	}
	#fl.clkd {
		fill: #f00;
	}
	#fl:active {
		transition: fill 0.1s;
		fill: #c00;
	}
	.comment {
		margin-top: 3px;
		padding: 4px;
	}
	.comment #up, .comment #dn {
		width: 18px;
	}
	.comment .hover {
		float: left;
		opacity: 0.3;
		padding: 2px 2px 0 0;
		height: 16px;
	}
	.comment .hover * {
		margin: 0;
	}
	.comment:hover .hover {
		opacity: 1;
	}
	.comment .rit {
		color: #666;
		font-size: 0.9em;
	}
	#comment:target + #addcomment {
		display: none;
	}
</style>
<script>
	var footerOff = true,
		noPageOverflow = 400,
		mainContentEl = document.getElementById('main'),
		mainBottomPad = 24;
	var p = '';
	function createCode() {
		return '&lt;!DOCTYPE html>&lt;html>&lt;body>' + document.getElementById('html').value + '&lt;style>' + document.getElementById('css').value + '&lt;/style>&lt;script>alert=prompt=confirm=null;' + document.getElementById('js').value + '&lt;/script>&lt;/body>&lt;/html>';
	}
	function run(f) {
		if (f == true || (p != createCode() &amp;&amp; document.getElementById('autorun').checked)) {
			if (f &amp;&amp; f != true) {
				onbeforeunload = function() {
					return 'You have unsaved code.';
				};
			}
			p = document.getElementById('output').srcdoc = createCode();
		}
	}
	document.getElementById('html').onkeypress = function(e) {
		if (e.keyCode === 13) {
			var oldSelectionStart = this.selectionStart;
			var tabs = this.value.substr(0,oldSelectionStart).split('\n')[this.value.substr(0,oldSelectionStart).split('\n').length-1].split('\t').length-((false/*Parse!*/)?0:1);
			this.value = this.value.substr(0,this.selectionStart)+'\n'+'\t'.repeat(tabs)+this.value.substr(this.selectionStart);
			this.selectionStart = ++oldSelectionStart + tabs;
			this.selectionEnd = this.selectionStart;
			e.preventDefault();
		}
		setTimeout(run, 0, 2);
	};
	document.getElementById('css').onkeypress = document.getElementById('js').onkeypress = function(e) {
		if (e.keyCode === 13) {
			var oldSelectionStart = this.selectionStart;
			var tabs = this.value.substr(0,oldSelectionStart).split('\n')[this.value.substr(0,oldSelectionStart).split('\n').length-1].split('\t').length-(this.value[oldSelectionStart-1]==='{'||this.value[oldSelectionStart-1]===':'?0:1);
			this.value = this.value.substr(0,this.selectionStart)+'\n'+'\t'.repeat(tabs)+this.value.substr(this.selectionStart);
			this.selectionStart = ++oldSelectionStart + tabs;
			this.selectionEnd = this.selectionStart;
			e.preventDefault();
		}
		setTimeout(run, 0, 2);
	};
	document.getElementById('html').onkeydown = document.getElementById('html').onkeyup = document.getElementById('css').onkeydown = document.getElementById('css').onkeyup = document.getElementById('js').onkeydown = document.getElementById('js').onkeyup = run;
	run();
	document.getElementById('save').onclick = function() {
		var e = this;
		if (e.classList.contains('progress')) return;
		e.classList.add('progress');
		setTimeout(function() {
			if (e.textContent == 'Save') e.textContent = 'Saving…';
		}, 200);
		request('/api/program/save?type=2', function(res) {
			if (res.indexOf('Error') === 0) {
				e.textContent = 'Retry?';
				alert(res);
			} else if (res.indexOf('Location') === 0) {
				onbeforeunload = null;
				location.href = res.split(' ')[1];
			} else if (res == 'Success') {
				onbeforeunload = null;
				e.textContent = 'Saved';
				document.getElementById('updated').setAttribute('datetime', new Date().toISOString());
			} else alert('Unknown error. Response was: ' + res);
			e.classList.remove('progress');
		}, 'html=' + encodeURIComponent(document.getElementById('html').value) + '&amp;css=' + encodeURIComponent(document.getElementById('css').value) + '&amp;js=' + encodeURIComponent(document.getElementById('js').value));
	};
	(document.getElementById('fork') || {}).onclick = function() {
		var e = this;
		if (e.classList.contains('progress')) return;
		e.classList.add('progress');
		e.textContent = 'Saving…';
		var e = e.previousSibling.previousSibling;
		e.hidden = e.previousSibling.previousSibling.hidden = true;
		request('/api/program/save?type=1&amp;fork=1', function(res) {
			if (res.indexOf('Error') === 0) {
				e.hidden = false;
				e = e.nextSibling.nextSibling;
				e.hidden = false;
				e.nextSibling.nextSibling.textContent = 'Fork';
				alert(res);
			} else if (res.indexOf('Location') === 0) {
				onbeforeunload = null;
				location.href = res.split(' ')[1];
			} else alert('Unknown error. Response was: ' + res);
			e.classList.remove('progress');
		}, 'html=' + encodeURIComponent(document.getElementById('html').value) + '&amp;css=' + encodeURIComponent(document.getElementById('css').value) + '&amp;js=' + encodeURIComponent(document.getElementById('js').value));
	};
	document.getElementById('title').onclick = function() {
		this.hidden = true;
		var edit = document.getElementById('edit-title');
		edit.hidden = false;
		edit.focus();
	};
	document.getElementById('edit-title').onblur = function() {
		request('/api/program/edit-title', function(res) {
			var edit = document.getElementById('edit-title');
			if (res.indexOf('Error') === 0) {
				if (confirm(res + '\n\nRetry?')) edit.onblur();
				else {
					edit.hidden = true;
					document.getElementById('title').hidden = false;
				}
			} else if (res == 'Success') {
				edit.hidden = true;
				var title = document.getElementById('title');
				title.textContent = edit.value.substr(0, 92);
				title.hidden = false;
			} else alert('Unknown error. Response was: ' + res);
		}, 'title=' + encodeURIComponent(this.value));
	};
	document.getElementById('edit-title').onkeypress = function(e) {
		if (e.keyCode == 13) this.onblur.call(this);
	};
</script>