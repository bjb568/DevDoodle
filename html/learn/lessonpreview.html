<div class="row">
	<div id="text">
		<div id="text-inner">
			<h1>$title</h1>
			<h2>$stitle</h2>
			$md-sbody
			<div id="checker">
				<button type="button" id="check" class="blk">Test User Submit</button>
				<div id="passed" class="passed clearfix">
					<h2><span id="passtext"> </span> <small class="rit" style="font-size: 14px; top: 6px;"><a href="../2/">Move on â†’</a></small></h2>
				</div>
				<div id="failed" class="failed clearfix">
					<h2>Try Again</h2>
					<p id="fail"> </p>
				</div>
			</div>
		</div>
		<div id="cntrls">
			<form action="?submit=1&amp;preview=0" method="post">
				<input type="hidden" value="$title" name="title" />
				<input type="hidden" value="$stitle" name="stitle" />
				<textarea hidden="" name="sbody">$sbody</textarea>
				<textarea hidden="" name="validate">$validate</textarea>
				<textarea hidden="" name="html">$html</textarea>
				<button type="submit">Save Lesson</button>
			</form>
			<form action="?submit=0&amp;preview=0" method="post" class="rit">
				<input type="hidden" value="$title" name="title" />
				<input type="hidden" value="$stitle" name="stitle" />
				<textarea hidden="" name="sbody">$sbody</textarea>
				<textarea hidden="" name="validate">$validate</textarea>
				<textarea hidden="" name="html">$html</textarea>
				<button type="submit">Edit Lesson</button>
			</form>
		</div>
	</div>
	<textarea id="html">$html</textarea>
	<iframe id="output"></iframe>
</div>
<textarea hidden="" id="canvas-js">$canvasjs</textarea>
<script src="/dev/runcanvas.js"></script>
	#cntrls form {
		display: inline;
		margin: 0;
	}
	#cntrls {
		padding: 4px;
		background: #0ff;
	}
	#cntrls button {
		height: 20px;
		width: 120px;
	}
</style>
<textarea hidden="" id="canvas-js">$canvasjs</textarea>
<script src="/dev/runcanvas.js"></script>
	var footerOff = true,
		noPageOverflow = 520,
		htmlTA = document.getElementById('html');
	document.getElementById('check').onclick = function(e) {
		e.preventDefault();
		var checkerWorker = new Worker(URL.createObjectURL(new Blob([$jsonvalidate + '\n;onmessage = function(e) { postMessage(validate(e.data)); }'])));
		checkerWorker.postMessage(htmlTA.value);
		checkerWorker.onerror = checkerWorker.onmessage = function(e) {
			if (e instanceof ErrorEvent) alert(e.message);
			console.log(e);
			var success = !e || !e.data || e.data.success;
			var msg = !e || !e.data || typeof(e.data.msg) != 'string' ? 'You did it!' : e.data.msg;
			document.getElementById(success ? 'passed' : 'failed').classList.add('show');
			document.getElementById(success ? 'failed' : 'passed').classList.remove('show');
			document.getElementById(success ? 'passtext' : 'fail').firstChild.nodeValue = msg;
			checkerWorker.terminate();
		};
	};
	var runTimeout;
	function run() {
		document.getElementById('output').src = 'data:application/xhtml+xml; charset=utf-8,' + document.getElementById('html').value;
	}
	run();
	function beforeRun() {
		clearTimeout(runTimeout);
		runTimeout = setTimeout(run, 100);
	}
	htmlTA.addEventListener('keyup', beforeRun);
	htmlTA.addEventListener('keydown', beforeRun);
	htmlTA.addEventListener('keypress', beforeRun);
</script>