<!DOCTYPE html>
<html>
	<head>
		<title>Syntax Highlighting</title>
		<script>
			'use strict';
			function html(input, replaceQuoteOff) {
				if (replaceQuoteOff) return input.toString().replaceAll(['&', '<'], ['&amp;', '&lt;']);
				return input.toString().replaceAll(['&', '<', '"'], ['&amp;', '&lt;', '&quot;']);
			}
			function highlight(input) {
				var output = '',
					string = false,
					lineComment = false,
					multilineComment = false,
					capVar = false,
					warnings = [],
					beforeWord;
				for (var i = 0; i < input.length; i++) {
					var c = input[i];
					if (lineComment) {
						if (c == '\n') {
							lineComment = false;
							output += '</span>';
						}
						output += html(c);
					} else if (multilineComment) {
						output += html(c);
						if (c == '/' && input[i - 1] == '*') {
							multilineComment = false;
							output += '</span>';
						}
					} else if (c === string) {
						string = false;
						output += c + '</span>';
					} else if (string && c == '\n') {
						warnings.push([i, 'Unexpected line end, string literal not terminated.']);
						string = false;
						output += '</span>\n';
					} else if (string) {
						if (c == '\\') output += '<span class="escape">';
						output += html(c);
						if (c == '\\') {
							output += html(c = input[++i]);
							if (c == 'u') {
								output += html(c = input[++i]);
								if (c == '{') {
									while ((c = input[++i]) && c != '}') {
										if (c == '\n' || c == string) {
											warnings.push([i, 'Unclosed bracket escape sequence.']);
											break;
										}
										output += html(c);
									}
									output += '}';
								} else output += html(input[++i] + input[++i] + input[++i]);
							} else if (c == 'x') output += html(input[++i] + input[++i]);
							output += '</span>';
						}
					} else if (c == '"' || c == "'") {
						string = c;
						output += '<span class="string">' + c;
					} else if (c == '/' && input[i + 1] == '/') {
						lineComment = true;
						output += '<span class="inline-comment">//';
						i++;
					} else if (c == '/' && input[i + 1] == '*') {
						multilineComment = true;
						output += '<span class="inline-comment">/*';
						i++;
					} else if (c != c.toLowerCase() && (input[i - 1] || ' ').match(/\W/)) {
						capVar = true;
						output += '<span class="cap-var">' + html(c);
					} else if (capVar && c.match(/\W/)) {
						capVar = false;
						output += '</span>';
						i--;
					} else if (input.substr(i, 9) == 'prototype') {
						output += '<span class="prototype">prototype</span>';
						i += 8;
					} else if ((beforeWord = !(input[i - 1] || '').match(/\w/)) && !(input[i + 2] || '').match(/\w/) && ['do', 'if', 'in'].indexOf(input.substr(i, 2)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 2) + '</span>';
						i++;
					} else if (beforeWord && !(input[i + 3] || '').match(/\w/) && ['for', 'let', 'new', 'try', 'var'].indexOf(input.substr(i, 3)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 3) + '</span>';
						i += 2;
					} else if (beforeWord && !(input[i + 4] || '').match(/\w/) && ['case', 'else', 'this', 'void', 'with'].indexOf(input.substr(i, 4)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 4) + '</span>';
						i += 3;
					} else if (beforeWord && !(input[i + 5] || '').match(/\w/) && ['break', 'class', 'catch', 'const', 'super', 'throw', 'while', 'yield'].indexOf(input.substr(i, 5)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 5) + '</span>';
						i += 4;
					} else if (beforeWord && !(input[i + 6] || '').match(/\w/) && ['delete', 'export', 'import', 'return', 'switch', 'typeof'].indexOf(input.substr(i, 6)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 6) + '</span>';
						i += 5;
					} else if (beforeWord && !(input[i + 7] || '').match(/\w/) && ['default', 'finally'].indexOf(input.substr(i, 7)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 7) + '</span>';
						i += 6;
					} else if (beforeWord && !(input[i + 8] || '').match(/\w/) && ['continue', 'debugger'].indexOf(input.substr(i, 8)) != -1) {
						output += '<span class="keyword">' + input.substr(i, 8) + '</span>';
						i += 7;
					} else if (beforeWord && !(input[i + 10] || '').match(/\w/) && input.substr(i, 10) == 'instanceof') {
						output += '<span class="keyword">' + input.substr(i, 10) + '</span>';
						i += 9;
					} else if (input.substr(i, 8) == 'function') {
						var l = c,
							end = i,
							start,
							sanitizedOutput = output.replaceAll('<span class=', '<span-class-');
						while (l = input[--end]) {
							if (l == '=') {
								end += output.length - i - '<span class="operator assigns"></span>'.length - 1;
								while (sanitizedOutput[end].match(/\s/)) end--;
								start = end;
								end++;
								while (start && !sanitizedOutput[start].match(/[\s=(]/)) start--;
								output = output.substring(0, start) + '<span class="function-name">' + output.substring(start, end) + '</span>' + output.substr(end);
								break;
							} else if (!l.match(/\s/)) break;
						}
						output += '<span class="keyword">function</span>';
						i += 6;
						var stop = ++i + input.substr(i).indexOf('(');
						if (!stop) {
							warnings.push([i, 'Function arguments not found.']);
							continue;
						}
						if ((c = input[++i]).match(/\s/)) {
							output += html(c) + '<span class="function-name">';
							while ((c = input[++i]) && c != '(') output += html(c);
							output += '</span>';
						}
						while (i < stop) output += input[++i];
						output += '<span class="punctuation">(</span>';
						var argString = '';
						while ((c = input[++i]) && c != ')') argString += c;
						output += argString.replace(/[^\s,]+/g, '<span class="argument">$&</span>').replaceAll(',', '<span class="punctuation">,</span>') + '<span class="punctuation">)</span>';
					} else if (c == '(') {
						var start = output.length,
							functionName = '',
							sanitizedOutput = output.replaceAll('<span class=', '<span-class-');
						while (!sanitizedOutput[--start].match(/[([{.\s]/)) functionName = output[start] + functionName;
						if (functionName.indexOf('</span>') == 0) {
							start += 7;
							functionName = functionName.substr(7);
						}
						output = output.substr(0, ++start) + '<span class="function-call">' + functionName + '</span><span class="punctuation">(</span>';
					} else if (',.;)[]{}'.indexOf(c) != -1) {
						output += '<span class="punctuation">' + c + '</span>';
					} else if (input.substr(i, 2) == '++' || input.substr(i, 2) == '--') {
						output += '<span class="operator assigns">' + c + input[++i] + '</span>';
					} else if (['*=', '/=', '%=', '+=', '-=', '&=', '|=', '^='].indexOf(input.substr(i, 2)) != -1) {
						output += '<span class="operator assigns">' + html(c) + '=</span>';
						i++;
					} else if (['<<=', '>>='].indexOf(input.substr(i, 3)) != -1) {
						output += '<span class="operator assigns">' + html(c + input[++i]) + '=</span>';
						i++;
					} else if (input.substr(i, 4) == '>>>=') {
						output += '<span class="operator assigns">>>>=</span>';
						i += 3;
					} else if (input.substr(i, 3) == '>>>') {
						output += '<span class="operator">' + html(input.substr(i, 3)) + '</span>';
						i += 2;
					} else if (['<=', '>=', '==', '!=', '===', '!==', '<<', '>>', '&&', '||'].indexOf(input.substr(i, 2)) != -1) {
						output += '<span class="operator">' + html(c + input[++i]) + '</span>';
					} else if ('+-~!*/%<>&|^?:'.indexOf(c) != -1) {
						output += '<span class="operator">' + html(c) + '</span>';
					} else if (c == '=') {
						output += '<span class="operator assigns">=</span>';
					} else if (beforeWord && c.match(/\d/)) {
						var start = i;
						if (c == '0' && (c = input[++i])) {
							if (c.toLowerCase() == 'b') {
								while ('01'.indexOf(input[++i]) != -1);
							} else if (c.toLowerCase() == 'o') {
								while ('01234567'.indexOf(input[++i]) != -1);
							} else if (c.toLowerCase() == 'x') {
								while ('0123456789abcdefABCDEF'.indexOf(input[++i]) != -1);
							} else if (c.match(/[\d\w]/)) warnings.push([i, 'Bad number literal.']);
							output += '<span class="number">' + input.substring(start, i--) + '</span>';
						} else {
							while ('0123456789.'.indexOf(input[i]) != -1) i++;
							if ((input[i] || '').toLowerCase() == 'e') {
								if ('+-'.indexOf(input[i])) i++;
								if ('0123456789'.indexOf(input[i]) == -1) warnings.push([i, 'No exponent found after "e".']);
								else i++;
								while ('0123456789.'.indexOf(input[i]) != -1) i++;
							}
							output += '<span class="number">' + input.substring(start, i) + '</span>';
							i--;
						}
					} else output += c;
				}
				console.log(output);
				console.log(warnings);
				return output.split('\n');
			}
			addEventListener('DOMContentLoaded', function() {
				var blocks = document.getElementsByTagName('code');
				var before = new Date().getTime();
				for (var i = 0; i < blocks.length; i++) {
					var block = blocks[i],
						code = highlight(block.textContent);
					block.classList.add('line-dig' + Math.floor(Math.log10(code.length)));
					block.innerHTML = code.map(function(line, i) {
						return '<span class="line" data-linenum="' + (i + 1) + '"></span>' + line;
					}).join('\n');
				}
				console.log(new Date().getTime() - before);
			});
		</script>
		<style>
			body {
				background: #000;
				tab-size: 4;
			}

			code.blk {
				display: block;
				background: #000;
				border: 1px solid #fff;
				color: #fff;
				padding: 4px;
				padding-left: 1.4em;
				white-space: pre-wrap;
				max-height: 600px;
				max-width: 100%;
				overflow: auto;
				word-break: normal;
				hyphens: none;
				-webkit-hyphens: none;
				position: relative;
				margin: 8px 0;
			}
			code .line::before {
				content: attr(data-linenum);
				color: #aaa;
				display: inline-block;
				-webkit-user-select: none;
				-moz-user-select: none;
				user-select: none;
				padding: 0 2px 0 4px;
				position: absolute;
				left: 0;
			}
			code.line-dig1 { padding-left: 2em }
			code.line-dig2 { padding-left: 2.6em }
			code.line-dig3 { padding-left: 3.2em }
			code.line-dig4 { padding-left: 3.8em }
			code.line-dig5 { padding-left: 4.4em }
			code.line-dig6 { padding-left: 5em }
			code.line-dig7 { padding-left: 5.6em }

			code .inline-comment { color: #777 }
			code .keyword { color: #fd3 }
			code .constant, code .string .escape { color: #df0 }
			code .string { color: #6C3 }
			code .regex { color: #ffa }
			code .regex.open, code .regex.close, code .regex.modifier, code .operator { color: #ff8 }
			code .operator.assigns { color: #8ff }
			code .regex .escape { color: #afa }
			code .regex.modifier { font-weight: bold }
			code .argument, code .number { color: #3df }
			code .newvar { font-weight: bold }
			code .function-name { color: #f60 }
			code .function-call { color: #f90 }
			code .prototype { color: #f00 }
			code .punctuation, code .grouper { color: #ccc }
			code .cap-var { color: #9ac }
			code .browser { color: #9ac }
			code .browser.method { color: #9bf }
			code .browser.property { color: #acf }
		</style>
	</head>
<body>
<code class="blk" data-language="javascript">1,5e;;;0;;;</code>
<code class="blk" data-language="javascript">String.prototype.replaceAll = function(find, replace) {
	if (typeof find == 'string') return this.split(find).join(replace);
	var t = this, i, j;
	while (typeof(i = find.shift()) == 'string' &amp;&amp; typeof(j = replace.shift()) == 'string') t = t.replaceAll(i || '', j || '');
	return t;
};
String.prototype.repeat = function(num) {
	return new Array(++num).join(this);
};
Number.prototype.bound = function(l, h) {
	return isNaN(h) ? Math.min(this, l) : Math.max(Math.min(this, h), l);
};
HTMLCollection.prototype.indexOf = NodeList.prototype.indexOf = Array.prototype.indexOf;
HTMLCollection.prototype.forEach = NodeList.prototype.forEach = Array.prototype.forEach;
HTMLElement.prototype.insertAfter = function(newEl, refEl) {
	if (refEl.nextSibling) refEl.parentNode.insertBefore(newEl, refEl.nextSibling);
	else refEl.parentNode.appendChild(newEl);
};

function html(input, replaceQuoteOff) {
	if (replaceQuoteOff) return input.toString().replaceAll(['&amp;', '&lt;'], ['&amp;amp;', '&amp;lt;']);
	return input.toString().replaceAll(['&amp;', '&lt;', '"'], ['&amp;amp;', '&amp;lt;', '&amp;quot;']);
}

var mdWarnings = [];
function warning(message) {
	console.log(message);
	mdWarnings.push(message);
}
function spanMarkdown(input) {
	input = html(input);
	while (input.match(/\^([\w\^]+)/)) input = input.replace(/\^([\w\^]+)/, '&lt;sup>$1&lt;/sup>');
	return input
		.replaceAll('\u0001', '^')
		.replace(/\[(.+?)\|(.+?)\]/g, '&lt;abbr title="$2">$1&lt;/abbr>')
		.replaceAll('\u0002', '[')
		.replace(/\[\[(\d+)\](.*?)\]/g, '&lt;sup class="reference" title="$2">[$1]&lt;/sup>')
		.replace(/!\[([^\]]+)]\(https?:\/\/([^\s("\\]+\.[^\s"\\]+)\)/g, '&lt;img alt="$1" src="https://$2" />')
		.replace(/^https?:\/\/([^\s("\\]+\.[^\s"\\]+\.(svg|png|tiff|jpg|jpeg)(\?[^\s"\\\/]*)?)/g, '&lt;img src="https://$1" />')
		.replace(/\[([^\]]+)]\((https?:\/\/[^\s("\\]+\.[^\s"\\]+)\)/g, '$1'.link('$2'))
		.replace(/([^;["\\])https?:\/\/([^\s("\\]+\.[^\s"\\]+\.(svg|png|tiff|jpg|jpeg)(\?[^\s"\\\/]*)?)/g, '$1&lt;img src="https://$2" />')
		.replace(/([^;["\\])(https?:\/\/([^\s("\\]+\.[^\s"\\]+))/g, '$1' + '$3'.link('$2'))
		.replace(/^(https?:\/\/([^\s("\\]+\.[^\s"\\]+))/g, '$2'.link('$1'));
}
function inlineMarkdown(input) {
	var output = '',
		span = '',
		current = [],
		tags = {
			'`': 'code',
			'``': 'samp',
			'*': 'em',
			'**': 'strong',
			'_': 'i',
			'–––': 's',
			'+++': 'ins',
			'---': 'del',
			'[c]': 'cite',
			'[m]': 'mark',
			'[u]': 'u',
			'[v]': 'var',
			'::': 'kbd',
			'"': 'q'
		},
		stags = {
			sup: {
				start: '^(',
				end: ')^'
			},
			sub: {
				start: 'v(',
				end: ')v'
			},
			small: {
				start: '[sm]',
				end: '[/sm]'
			}
		};
	outer: for (var i = 0; i &lt; input.length; i++) {
		if (['code', 'samp'].indexOf(current[current.length - 1]) == -1) {
			if (input[i] == '\\') span += input[++i].replace('^', '\u0001').replace('[', '\u0002');
			else {
				for (var l = 3; l > 0; l--) {
					if (tags[input.substr(i, l)]) {
						output += spanMarkdown(span);
						span = '';
						if (current[current.length - 1] == tags[input.substr(i, l)]) output += '&lt;/' + current.pop() + '>';
						else {
							if (current.indexOf(tags[input.substr(i, l)]) != -1) warning('Illegal nesting of "' + input.substr(i, l) + '"');
							output += '&lt;' + tags[input.substr(i, l)] + '>';
							current.push(tags[input.substr(i, l)]);
						}
						i += l - 1;
						continue outer;
					}
				}
				for (var j in stags) {
					for (var l = 5; l > 0; l--) {
						if (stags[j].start == input.substr(i, l)) {
							output += spanMarkdown(span) + '&lt;' + j + '>';
							span = '';
							current.push(stags[j].end);
							i += l - 1;
							continue outer;
						} else if (stags[j].end == input.substr(i, l)) {
							if (current[current.length - 1] == stags[j].end) {
								output += spanMarkdown(span) + '&lt;/' + j + '>';
								span = '';
								current.pop();
								i += l - 1;
								continue outer;
							} else warning('Illegal close tag "' + stags[j].end + '" found');
						}
					}
				}
				span += input[i];
			}
		} else if (current[current.length - 1] == 'code' &amp;&amp; input[i] == '`') {
			current.pop();
			output += '&lt;/code>';
		} else if (current[current.length - 1] == 'samp' &amp;&amp; input.substr(i, 2) == '``') {
			current.pop();
			output += '&lt;/samp>';
			i++;
		} else output += html(input[i]);
	}
	output += spanMarkdown(span);
	if (current.length) warning('Unclosed tags. &lt;' + current.join('>, &lt;') + '>');
	for (var i = current.length - 1; i >= 0; i--) output += '&lt;/' + current[i] + '>';
	return output;
}
function markdown(input) {
	if (input.indexOf('\n') == -1 &amp;&amp; input.substr(0, 2) != '> ' &amp;&amp; input.substr(0, 3) != '>! ' &amp;&amp; input.substr(0, 2) != '- ' &amp;&amp; input.substr(0, 2) != '* ' &amp;&amp; input.substr(0, 4) != '    ' &amp;&amp; input[0] != '\t' &amp;&amp; !input.match(/^((\d+|[A-z])[.)]|#{1,6}|cite\[\d+\]:) /) &amp;&amp; !input.match(/^[-–—]{12,}$/)) return inlineMarkdown(input);
	var blockquote = '',
		ul = '',
		ol = '',
		li = '',
		code = '',
		i;
	return input.split('\n').map(function(val, i, arr) {
		if (!val) return '';
		var f;
		if (val.substr(0, 2) == '> ') {
			val = val.substr(2);
			if (arr[i + 1] &amp;&amp; arr[i + 1].substr(0, 2) == '> ') {
				blockquote += val + '\n';
				return '';
			} else {
				var arg = blockquote + val;
				blockquote = '';
				return '&lt;blockquote>' + markdown(arg) + '&lt;/blockquote>';
			}
		} else if (val.substr(0, 3) == '>! ') {
			val = val.substr(3);
			if (arr[i + 1] &amp;&amp; arr[i + 1].substr(0, 3) == '>! ') {
				blockquote += val + '\n';
				return '';
			} else {
				var arg = blockquote + val;
				blockquote = '';
				return '&lt;blockquote class="spoiler">' + markdown(arg) + '&lt;/blockquote>';
			}
		} else if (val.substr(0, 2) == '- ' || val.substr(0, 2) == '* ') {
			if (!ul) ul = '&lt;ul>';
			val = val.substr(2);
			if (li) {
				ul += '&lt;li>' + markdown(li) + '&lt;/li>';
				li = '';
			}
			if (arr[i + 1] &amp;&amp; (arr[i + 1].substr(0, 2) == '- ' || arr[i + 1] &amp;&amp; arr[i + 1].substr(0, 2) == '* ')) {
				ul += '&lt;li>' + inlineMarkdown(val) + '&lt;/li>';
				return '';
			} else if (arr[i + 1] &amp;&amp; (arr[i + 1][0] == '\t' || arr[i + 1] &amp;&amp; arr[i + 1].substr(0, 4) == '    ')) {
				li += val + '\n';
				return '';
			} else {
				var arg = ul + '&lt;li>' + markdown(val) + '&lt;/li>';
				ul = '';
				return arg + '&lt;/ul>';
			}
		} else if (f = val.match(/^(\d+|[A-z])[.)] /)) {
			if (!ol) ol = '&lt;ol>';
			val = val.substr(f[0].length);
			if (li) {
				ol += '&lt;li>' + markdown(li) + '&lt;/li>';
				li = '';
			}
			if (arr[i + 1] &amp;&amp; arr[i + 1].match(/^(\d+|[A-z])[.)] /)) {
				ol += '&lt;li>' + inlineMarkdown(val) + '&lt;/li>';
				return '';
			} else if (arr[i + 1] &amp;&amp; (arr[i + 1][0] == '\t' || arr[i + 1] &amp;&amp; arr[i + 1].substr(0, 4) == '    ')) {
				li += val + '\n';
				return '';
			} else {
				var arg = ol + '&lt;li>' + inlineMarkdown(val) + '&lt;/li>';
				ol = '';
				return arg + '&lt;/ol>';
			}
		} else if (li &amp;&amp; val[0] == '\t') {
			li += val.substr(1) + '\n';
			if (ul &amp;&amp; (!arr[i + 1] || (arr[i + 1][0] != '\t' &amp;&amp; arr[i + 1].substr(0, 4) != '    ' &amp;&amp; arr[i + 1].substr(2) != '- ' &amp;&amp; arr[i + 1].substr(2) != '* '))) {
				var arg = ul + '&lt;li>' + markdown(li) + '&lt;/li>';
				li = '';
				return arg + '&lt;/ul>';
			} else if (ol &amp;&amp; (!arr[i + 1] || (arr[i + 1][0] != '\t' &amp;&amp; arr[i + 1].substr(0, 4) != '    ' &amp;&amp; !arr[i + 1].match(/^(\d+|[A-z])[.)] /)))) {
				var arg = ol + '&lt;li>' + markdown(li) + '&lt;/li>';
				li = '';
				return arg + '&lt;/ol>';
			}
			return '';
		} else if (li &amp;&amp; val.substr(0, 4) == '    ') {
			li += val.substr(4) + '\n';
			if (ul &amp;&amp; (!arr[i + 1] || (arr[i + 1][0] != '\t' &amp;&amp; arr[i + 1].substr(0, 4) != '    ' &amp;&amp; arr[i + 1].substr(2) != '- ' &amp;&amp; arr[i + 1].substr(2) != '* '))) {
				var arg = ul + '&lt;li>' + markdown(li) + '&lt;/li>';
				li = '';
				return arg + '&lt;/ul>';
			} else if (ol &amp;&amp; (!arr[i + 1] || (arr[i + 1][0] != '\t' &amp;&amp; arr[i + 1].substr(0, 4) != '    ' &amp;&amp; !arr[i + 1].match(/^((\d+|[A-z])|[A-z])[.)] /)))) {
				var arg = ol + '&lt;li>' + markdown(li) + '&lt;/li>';
				li = '';
				return arg + '&lt;/ol>';
			}
			return '';
		} else if (val[0] == '\t') {
			code += val.substr(1);
			if (!arr[i + 1] || (arr[i + 1].substr(0, 4) != '    ' &amp;&amp; arr[i + 1][0] != '\t')) {
				var arg = html(code);
				code = '';
				return '&lt;code class="blk">' + arg + '&lt;/code>';
			} else code += '\n';
			return '';
		} else if (val.substr(0, 4) == '    ') {
			code += val.substr(4);
			if (!arr[i + 1] || (arr[i + 1].substr(0, 4) != '    ' &amp;&amp; arr[i + 1][0] != '\t')) {
				var arg = html(code);
				code = '';
				return '&lt;code class="blk">' + arg + '&lt;/code>';
			} else code += '\n';
			return '';
		} else if ((f = val.match(/^#{1,6} /)) &amp;&amp; (f = f[0].length - 1)) {
			return '&lt;h' + f + '>' + inlineMarkdown(val.substr(f + 1)) + '&lt;/h' + f + '>';
		} else if (val.match(/^[-–—]{12,}$/)) {
			return '&lt;hr />';
		} else if (i = val.match(/^cite\[(\d+)\]: /)) {
			return '&lt;div>&lt;sup class="reference-list">' + i[1] + '&lt;/sup> ' + inlineMarkdown(val.substr(i[0].length)) + '&lt;/div>';
		} else return '&lt;p>' + inlineMarkdown(val) + '&lt;/p>';
	}).join('');
}

HTMLTextAreaElement.prototype.mdValidate = function(correct) {
	var i = mdWarnings.length;
	markdown(this.value);
	var preverr = this.previousElementSibling &amp;&amp; this.previousElementSibling.classList.contains('md-err') ? this.previousElementSibling : null,
		err = mdWarnings[i];
	this.lastErrored = err &amp;&amp; correct;
	if (err &amp;&amp; (correct || preverr || this.value.substr(0, this.selectionEnd || Infinity).match(/\s$/))) {
		if (preverr) {
			if (preverr.firstChild.nodeValue == err) {
				if (this.lastErrored &amp;&amp; err &amp;&amp; correct) {
					this.value = this.value.replace(/([^\\]?)(\\*)([`*_–\-+[(:"])/g, function(m, p1, p2, p3, i) {
						if (i &amp;&amp; !p1) return m;
						return p1 + (p2.length % 2 ? p2 : p2 + '\\') + p3;
					});
					return true;
				}
				return err;
			}
			preverr.parentNode.removeChild(preverr);
		}
		var span = document.createElement('span');
		span.classList.add('md-err');
		span.appendChild(document.createTextNode(err));
		this.parentNode.insertBefore(span, this);
	} else if (preverr) preverr.parentNode.removeChild(preverr);
	return err;
};

function mdValidateBody() {
	if (document.activeElement.mdValidate &amp;&amp; document.activeElement.id != 'code') document.activeElement.mdValidate();
};
addEventListener('input', mdValidateBody);

var noPageOverflow = noPageOverflow || false,
	pageOverflowMobile = pageOverflowMobile || false,
	footerOff = footerOff || false,
	mainContentEl = mainContentEl || false,
	mainBottomPad = mainBottomPad || 0;

function minHeight() {
	var footer = document.getElementById('footer').offsetHeight,
		sidebar = document.getElementById('sidebar');
	if (innerWidth &lt; 1500 &amp;&amp; sidebar) footer += sidebar.offsetHeight + 6;
	if (noPageOverflow &amp;&amp; !(innerWidth &lt; pageOverflowMobile)) {
		mainContentEl.style.minHeight = '';
		mainContentEl.style.height = Math.max(innerHeight - (footerOff ? -4 : footer) - mainContentEl.getBoundingClientRect().top + document.body.getBoundingClientRect().top - 12, noPageOverflow) - mainBottomPad + 'px';
		if (sidebar) sidebar.style.height = '';
	} else {
		mainContentEl.style.height = '';
		if (navigator.userAgent.indexOf('Mobile') == -1) mainContentEl.style.minHeight = Math.max(0, innerHeight - (footerOff ? -4 : footer) - mainContentEl.getBoundingClientRect().top + document.body.getBoundingClientRect().top - (innerWidth &lt; 1500 ? 6 : 12) - mainBottomPad) + 'px';
		else mainContentEl.style.minHeight = '';
		if (sidebar) {
			if (innerWidth >= 1500) sidebar.style.height = mainContentEl.style.minHeight;
			else sidebar.style.height = '';
		}
	}
}
addEventListener('load', minHeight);
addEventListener('resize', minHeight);

function request(uri, callback, params) {
	var i = new XMLHttpRequest();
	i.open('POST', uri, true);
	i.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	i.send(params);
	i.onload = function() {
		callback(this.status == 204 ? 'Success' : this.responseText);
	};
	return i;
}

function ago(od) {
	var d = Math.round((new Date() - od) / 1000);
	if (d &lt; 3600) return Math.round(d / 60) + 'm ago';
	else if (d &lt; 86400) return Math.round(d / 3600) + 'h ago';
	else if (d &lt; 2592000) return Math.round(d / 86400) + 'd ago';
	else {
		d = new Date(od);
		var y = d.getUTCFullYear();
		return ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec' ][d.getUTCMonth()] + ' ' + d.getUTCDate() + (y == new Date().getUTCFullYear() ? '' : ' \'' + y.toString().substr(2));
	}
}
function agot(d) {
	var time = document.createElement('time');
	time.textContent = ago(d);
	time.setAttribute('datetime', new Date(d).toISOString());
	return time;
}

function textareaHandler(e) {
	if (this.noHandle) return delete this.nHandle;
	if (!this.hist) this.hist = [{
		body: '',
		start: 0,
		end: 0
	}];
	if (!this.hIndex) this.hIndex = 0;
	if (e.keyCode == 9) {
		if (this.selectionStart == this.selectionEnd) {
			if (e.shiftKey) {
				var cS = this.selectionEnd - 1;
				while (this.value[cS] &amp;&amp; this.value[cS] != '\n') {
					if (this.value[cS] == '\t') {
						this.value = this.value.substr(0, cS) + this.value.substr(++cS);
						break;
					} else cS--;
				}
			} else {
				var oS = this.selectionEnd;
				this.value = this.value.substr(0, oS) + '\t' + this.value.substr(oS);
				this.selectionStart = this.selectionEnd = ++oS;
			}
		} else {
			var lines = this.value.split('\n'),
				i = 0,
				start = 0;
			while ((i += lines[start].length) &lt; this.selectionStart - start) start++;
			var end = start;
			i -= lines[start].length;
			while ((i += lines[end].length) &lt; this.selectionEnd - end) end++;
			i = --start;
			while (++i &lt;= end) {
				if (e.shiftKey) lines[i][0] != '\t' || (lines[i] = lines[i].substr(1));
				else lines[i] = '\t' + lines[i];
			}
			this.value = lines.join('\n');
			var nS = lines.slice(0, ++start).join('\n').length;
			this.selectionStart = (nS += nS ? 1 : 0);
			this.selectionEnd = nS + lines.slice(start, ++end).join('\n').length;
		}
		e.preventDefault();
	} else if (e.keyCode == 90 &amp;&amp; e.metaKey &amp;&amp; !e.altKey) {
		e.preventDefault();
		if (this.hIndex == this.hist.length - 1 &amp;&amp; this.hist[this.hIndex].body != this.value) {
			this.hist.push({
				body: this.value,
				start: this.selectionStart,
				end: this.selectionEnd
			});
			this.hIndex = this.hist.length - 1;
		}
		var data = this.hist[e.shiftKey ? ++this.hIndex : --this.hIndex];
		console.log(this.hist, this.hIndex);
		if (data) {
			this.value = data.body;
			this.selectionStart = data.start;
			this.selectionEnd = data.end;
		} else e.shiftKey ? --this.hIndex : ++this.hIndex
	} else {
		if (this.hist[this.hIndex].body != this.value) this.hist = this.hist.slice(0, this.hIndex + 1);
		if (this.timer) clearTimeout(this.timer);
		this.timer = setTimeout(function(e) {
			if (e.hIndex != e.hist.length - 1) return;
			if (e.hist[e.hIndex].body == e.value) return;
			e.hist.push({
				body: e.value,
				start: e.selectionStart,
				end: e.selectionEnd
			});
			e.hIndex = e.hist.length - 1;
		}, this.lastKeyCode == e.keyCode || [8, 9, 13].indexOf(e.keyCode) == -1 ? 400 : 0, this);
	}
	this.lastKeyCode = e.keyCode;
}

addEventListener('DOMContentLoaded', function() {
	mainContentEl = mainContentEl || document.getElementById('content');
	if (navigator.userAgent.indexOf('Trident') != -1 || navigator.userAgent.indexOf('MSIE') != -1) {
		var span = document.createElement('span');
		span.appendChild(document.createTextNode('This site does not support Microsoft Internet Explorer due to its lack of compatibility with web specifications.'));
		document.getElementById('err').appendChild(span);
		document.getElementById('cont').hidden = true;
		document.getElementById('cont').style.display = 'none';
	}
	var e = document.getElementsByTagName('textarea'),
		i = e.length;
	while (i--) e[i].addEventListener('keydown', textareaHandler);
	setInterval(function() {
		var times = document.getElementsByTagName('time');
		for (var i = 0; i &lt; times.length; i++) {
			var t = ago(Date.parse(times[i].getAttribute('datetime')));
			if (times[i].textContent != t) times[i].textContent = t;
		}
	}, 100);
	minHeight();
});

document.addEventListener('visibilitychange', function() {
	if (!document.hidden) {
		request('/api/notif', function(res) {
			document.getElementById('nav').children[7].classList.toggle('unread', res);
		});
	}
});

if (navigator.userAgent.indexOf('Mobile') != -1) addEventListener('touchend', function() {}); //Fixes mobile-safari bug with touch listeners in iframes not firing</code>
</body>
</html>